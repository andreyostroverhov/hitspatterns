<!DOCTYPE html>
<html>
<head>
    <title>Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .dashboard {
            width: 90%;
            margin: 2rem auto;
            font-family: Arial, sans-serif;
        }

        .chart-container {
            margin: 2rem 0;
            padding: 1rem;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .stats-box {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            padding: 1rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <h1>Service Monitoring Dashboard</h1>

        <div class="stats-box">
            <div class="stat-item">
                <h3>Total Requests</h3>
                <p id="totalRequests">Loading...</p>
            </div>
            <div class="stat-item">
                <h3>Total Errors</h3>
                <p id="totalErrors">Loading...</p>
            </div>
            <div class="stat-item">
                <h3>Global Error Rate</h3>
                <p id="globalErrorRate">Loading...</p>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="errorRateChart"></canvas>
        </div>

        <div class="chart-container">
            <canvas id="requestsChart"></canvas>
        </div>
    </div>

    <script>
        // Загрузка данных
        fetch('/api/monitoring/statistics')
            .then(response => response.json())
            .then(data => {
                // Обновление статистики
                document.getElementById('totalRequests').textContent = data.summary.totalRequests;
                document.getElementById('totalErrors').textContent = data.summary.totalErrors;
                document.getElementById('globalErrorRate').textContent = `${data.summary.globalErrorRate}%`;

                // Подготовка данных для графиков
                const labels = data.hourlyStats.map(item => item.time);
                const errorRates = data.hourlyStats.map(item => item.errorRate);
                const totalRequests = data.hourlyStats.map(item => item.totalRequests);
                const errorCounts = data.hourlyStats.map(item => item.errorCount);

                // График уровня ошибок
                new Chart(document.getElementById('errorRateChart'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Error Rate (%)',
                            data: errorRates,
                            borderColor: '#ff6384',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });

                // График запросов и ошибок
                new Chart(document.getElementById('requestsChart'), {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Total Requests',
                            data: totalRequests,
                            backgroundColor: '#4bc0c0'
                        },
                        {
                            label: 'Errors',
                            data: errorCounts,
                            backgroundColor: '#ff6384'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error('Error loading data:', error);
                document.querySelector('.dashboard').innerHTML = `
                    <div style="color: red; text-align: center; padding: 2rem;">
                        Error loading monitoring data. Please try again later.
                    </div>
                `;
            });
    </script>
</body>
</html>